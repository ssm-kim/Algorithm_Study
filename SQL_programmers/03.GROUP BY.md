## GROUP BY(집계함수) ORACLE 풀이 (solve 10 problems separate them)

##### 공통 링크 - https://school.programmers.co.kr/learn/courses/30/parts/17044

<br/>

- 즐겨찾기가 가장 많은 식당 정보 출력하기
  - GROUP BY + WHERE절 서브쿼리 해결

```SQL
SELECT FOOD_TYPE, REST_ID, REST_NAME, FAVORITES
FROM REST_INFO
WHERE (FOOD_TYPE, FAVORITES) IN ( SELECT FOOD_TYPE, FAVORITES
                                  FROM (  SELECT FOOD_TYPE, MAX(FAVORITES) FAVORITES
                                          FROM REST_INFO
                                          GROUP BY FOOD_TYPE ))
ORDER BY FOOD_TYPE DESC
```

<br/>

- 조건에 맞는 사용자와 총 거래금액 조회하기

```SQL
SELECT *
FROM (
        SELECT B.USER_ID, B.NICKNAME, SUM(A.PRICE) TOTAL_SALES
        FROM USED_GOODS_BOARD A INNER JOIN USED_GOODS_USER B ON A.WRITER_ID = B.USER_ID
        WHERE A.STATUS = 'DONE'
        GROUP BY B.USER_ID, B.NICKNAME
    )
WHERE TOTAL_SALES >= 700000
ORDER BY TOTAL_SALES ASC
```

<br/>

- 저자 별 카테고리 별 매출액 집계하기

```SQL
SELECT A.AUTHOR_ID, A.AUTHOR_NAME, A.CATEGORY, SUM(A.PRICE * B.SALES) TOTAL_SALES
FROM
        -- 공통 키값인 BOOK_ID 컬럼으로 INNER JOIN
      ( SELECT A.AUTHOR_ID, A.AUTHOR_NAME, B.PRICE, B.CATEGORY, B.BOOK_ID  -- AUTHOR, BOOK 테이블 JOIN
        FROM AUTHOR A LEFT JOIN BOOK B ON A.AUTHOR_ID = B.AUTHOR_ID ) A
        INNER JOIN
      ( SELECT C.BOOK_ID, C.SALES  -- 2022.01 BOOK_SAELS 데이터 조회
        FROM BOOK_SALES C
        WHERE TO_CHAR(SALES_DATE, 'YYYYMM') = '202201') B ON A.BOOK_ID = B.BOOK_ID

GROUP BY A.AUTHOR_ID, A.AUTHOR_NAME, A.CATEGORY
ORDER BY A.AUTHOR_ID ASC, A.CATEGORY DESC
```

<br/>

- 카테고리 별 도서 판매량 집계하기

```SQL
SELECT A.CATEGORY, SUM(B.SALES) TOTAL_SALES
FROM BOOK A INNER JOIN BOOK_SALES B ON A.BOOK_ID = B.BOOK_ID
WHERE TO_CHAR(B.SALES_DATE, 'YYYYMM') = '202201'
GROUP BY A.CATEGORY
ORDER BY A.CATEGORY ASC
```

<br/>

- 자동차 대여 기록에서 대여중 / 대여 가능 여부 구분하기

```SQL
SELECT CAR_ID,
       MAX( CASE WHEN '20221016' BETWEEN TO_CHAR(START_DATE, 'YYYYMMDD') AND TO_CHAR(END_DATE, 'YYYYMMDD')
            THEN '대여중'
            ELSE '대여 가능'
            END ) AS AVAILABILITY
FROM CAR_RENTAL_COMPANY_RENTAL_HISTORY
GROUP BY CAR_ID
ORDER BY CAR_ID DESC
```

<br/>

- 진료과별 총 예약 횟수 출력하기

```SQL
SELECT MCDP_CD 진료과코드, COUNT(APNT_NO)
FROM APPOINTMENT
WHERE TO_CHAR(APNT_YMD, 'YYYYMM') = '202205'
GROUP BY MCDP_CD
ORDER BY COUNT(APNT_NO) ASC, MCDP_CD ASC
```

<br/>

- 자동차 종류 별 특정 옵션이 포함된 자동차 수 구하기

```SQL
SELECT CAR_TYPE, COUNT(CAR_ID) CARS
FROM CAR_RENTAL_COMPANY_CAR
WHERE OPTIONS LIKE '%통풍시트%'
    OR OPTIONS LIKE '%열선시트%'
    OR OPTIONS LIKE '%가죽시트%'
GROUP BY CAR_TYPE
ORDER BY CAR_TYPE ASC
```

<br/>

- 대여 횟수가 많은 자동차들의 월별 대여 횟수 구하기
  - 다시해보기

```SQL
SELECT TO_NUMBER(TO_CHAR(START_DATE, 'MM')) MONTH, CAR_ID, COUNT(CAR_ID) RECORDS
FROM CAR_RENTAL_COMPANY_RENTAL_HISTORY
WHERE TO_CHAR(START_DATE, 'YYYYMM') BETWEEN '202208' AND '202210'
  AND CAR_ID IN (   SELECT CAR_ID
                    FROM CAR_RENTAL_COMPANY_RENTAL_HISTORY
                    WHERE TO_CHAR(START_DATE, 'YYYYMM') BETWEEN '202208' AND '202210'
                    GROUP BY CAR_ID
                    HAVING COUNT(CAR_ID) >= 5   )
GROUP BY TO_CHAR(START_DATE, 'MM'), CAR_ID
ORDER BY TO_NUMBER(TO_CHAR(START_DATE, 'MM')) ASC, CAR_ID DESC
```

<br/>

- 성분으로 구분한 아이스크림 총 주문량

```SQL
SELECT B.INGREDIENT_TYPE, SUM(A.TOTAL_ORDER) TOTAL_ORDER
FROM FIRST_HALF A INNER JOIN ICECREAM_INFO B ON A.FLAVOR = B.FLAVOR
GROUP BY B.INGREDIENT_TYPE
ORDER BY TOTAL_ORDER ASC
```

<br/>

- 식품분류별 가장 비싼 식품의 정보 조회하기
  - 다시 해보기

```SQL
SELECT CATEGORY, PRICE MAX_PRICE, PRODUCT_NAME
FROM FOOD_PRODUCT
WHERE (CATEGORY, PRICE) IN
                            ( SELECT CATEGORY, MAX(PRICE)
                              FROM FOOD_PRODUCT
                              WHERE CATEGORY IN ('과자', '국', '김치', '식용유')
                              GROUP BY CATEGORY )
ORDER BY PRICE DESC
```

<br/>

---

<br/>

- 고양이와 개는 몇 마리 있을까

```SQL
SELECT ANIMAL_TYPE, COUNT(ANIMAL_ID) COUNT
FROM ANIMAL_INS
GROUP BY ANIMAL_TYPE
ORDER BY ANIMAL_TYPE ASC
```

<br/>

- 동명 동물 수 찾기

```SQL

```

<br/>

- 년, 월, 성별 별 상품 구매 회원 수 구하기

```SQL

```

<br/>

- 입양 시각 구하기(1)

```SQL

```

<br/>

- 입양 시각 구하기(2)

```SQL

```

<br/>

- 가격대 별 상품 개수 구하기

```SQL

```
